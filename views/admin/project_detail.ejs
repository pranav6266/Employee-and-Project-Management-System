<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Details: <%= project.title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<%- include('../partials/_admin_navbar') %>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3><%= project.title %></h3>
        <a href="/admin/projects" class="btn btn-secondary">Back to Projects</a>
    </div>

    <div class="card mb-4">
        <div class="card-header">Project Information</div>
        <div class="card-body">
            <p><strong>Description:</strong> <%= project.description %></p>
            <p><strong>Status:</strong> <%= project.status %></p>
            <p><strong>Dates:</strong> <%= new Date(project.startDate).toLocaleDateString() %> to <%= new Date(project.endDate).toLocaleDateString() %></p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Assigned Tasks</div>
                <div class="card-body">
                    <% if(modules.length > 0) { %>
                        <ul class="list-group">
                            <% modules.forEach(mod => { %>
                                <li class="list-group-item">
                                    <strong><%= mod.title %></strong> - Assigned to: <%= mod.assignedTo.name %>
                                    <span class="badge float-end
                                        <% if (mod.status === 'Pending') { %> bg-warning text-dark <% } %>
                                        <% if (mod.status === 'In Progress') { %> bg-info text-dark <% } %>
                                        <% if (mod.status === 'Completed') { %> bg-success <% } %>
                                    "><%= mod.status %></span>
                                </li>
                            <% }); %>
                        </ul>
                    <% } else { %>
                        <p>No tasks have been assigned to this project yet.</p>
                    <% } %>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Assign New Task</div>
                <div class="card-body">
                    <form action="/admin/projects/<%= project._id %>/assign-module" method="POST">
                        <div class="mb-2">
                            <label for="title" class="form-label">Task Title</label>
                            <input type="text" class="form-control form-control-sm" name="title" required>
                        </div>
                        <div class="mb-2">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control form-control-sm" name="description" rows="2"></textarea>
                        </div>
                        <div class="mb-2">
                            <label for="assignedTo" class="form-label">Assign To</label>
                            <select class="form-select form-select-sm" name="assignedTo" required>
                                <% employees.forEach(emp => { %>
                                    <option value="<%= emp._id %>"><%= emp.name %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control form-control-sm" name="startDate">
                        </div>
                        <div class="mb-2">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control form-control-sm" name="endDate">
                        </div>
                        <div class="mb-2">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select form-select-sm" name="status">
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-sm">Assign Task</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>